<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QuranBits Global - Quran Explorer</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=DM+Sans:wght@400;500;700&family=Noto+Nastaliq+Urdu:wght@400..700&display=swap" rel="stylesheet">
  <style>
    :root {
      --color-bg-main: #0a0f16;
      --color-bg-secondary: #121a23;
      --color-gold: #d4af37;
      --color-gold-glow: rgba(212, 175, 55, 0.3);
      --color-text-light: #e8ecf4;
      --color-text-muted: #8b9bb1;
      --color-text-arabic: #f3d49f;
      --glass-bg: rgba(30, 41, 56, 0.7);
      --glass-border: rgba(255, 255, 255, 0.08);
      --backdrop-blur: blur(12px);
      --radius: 16px;
      --transition-speed: 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: radial-gradient(circle at top center, #1a2433 0%, var(--color-bg-main) 70%);
      color: var(--color-text-light);
      line-height: 1.7;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* --- Animations --- */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-in { animation: fadeInUp 0.6s ease forwards; opacity: 0; }

    /* --- Shared Styles --- */
    .glass-panel {
      background: var(--glass-bg);
      backdrop-filter: var(--backdrop-blur);
      -webkit-backdrop-filter: var(--backdrop-blur);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    header {
      background: rgba(15, 22, 28, 0.9);
      backdrop-filter: blur(10px);
      padding: 40px 20px;
      text-align: center;
      border-bottom: 2px solid var(--color-gold-glow);
      position: sticky; top: 0; z-index: 100;
    }
    header h1 { font-size: 3rem; color: var(--color-gold); text-shadow: 0 0 20px var(--color-gold-glow); margin-bottom: 10px; }
    header p { opacity: 0.9; font-size: 1.1rem; max-width: 600px; margin: 0 auto; }

    .container { max-width: 1200px; margin: 40px auto 100px; padding: 0 25px; }
    
    .loading { text-align: center; padding: 100px; color: var(--color-gold); font-size: 1.5rem; animation: pulse 2s infinite; }
    @keyframes pulse { 50% { opacity: 0.5; } }

    /* --- Surah Grid --- */
    .surah-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; margin-bottom: 40px; }
    .surah-card { padding: 25px; display: flex; flex-direction: column; justify-content: space-between; cursor: pointer; text-decoration: none; transition: all var(--transition-speed); position: relative; overflow: hidden; }
    .surah-card:hover { transform: translateY(-7px) scale(1.02); border-color: var(--color-gold); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5), inset 0 0 20px rgba(212, 175, 55, 0.1); }
    .surah-card-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
    .surah-number { font-size: 1.8rem; font-weight: 900; color: rgba(255,255,255,0.1); position: absolute; top: 10px; left: 20px; }
    .arabic-name { font-family: 'Amiri Quran', serif; font-size: 2rem; color: var(--color-text-arabic); direction: rtl; margin-left: auto; z-index: 1; }
    .surah-content { z-index: 1; margin-top: 20px; }
    .surah-title-en { font-size: 1.4rem; font-weight: 700; display: block; margin-bottom: 8px; }
    .surah-meta { color: var(--color-text-muted); font-size: 0.95rem; display: flex; flex-wrap: wrap; gap: 10px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
    .meta-badge { background: rgba(0,0,0,0.3); padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; }

    /* --- Details View --- */
    .ayah-container { padding: 35px; margin-bottom: 30px; position: relative; }
    .ayah-container::before { content: ''; position: absolute; left: 0; top: 20px; bottom: 20px; width: 4px; background: var(--color-gold); border-radius: 0 4px 4px 0; box-shadow: 2px 0 10px var(--color-gold-glow); }
    .ayah-header { display: flex; align-items: center; margin-bottom: 20px; }
    .ayah-number-badge { background: linear-gradient(135deg, var(--color-gold), #a88235); color: var(--color-bg-main); display: inline-flex; align-items: center; justify-content: center; width: 45px; height: 45px; border-radius: 50%; margin-right: 15px; font-size: 1.2rem; font-weight: 800; box-shadow: 0 4px 15px var(--color-gold-glow); }
    .arabic-text { font-family: 'Amiri Quran', serif; font-size: 2.4rem; color: var(--color-text-arabic); line-height: 2.6; text-align: right; margin: 30px 0; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6); }
    
    .translation { font-size: 1.15rem; color: var(--color-text-light); padding: 25px 0; border-top: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; }
    /* Specific font for Urdu/RTL languages if needed */
    .translation[dir="rtl"] { font-family: 'Noto Nastaliq Urdu', serif; font-size: 1.3rem; line-height: 2.2; }

    /* --- Controls & Inputs --- */
    .controls-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
    .control-header { margin-bottom: 8px; color: var(--color-gold); font-weight: 600; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
    
    select.modern-select { width: 100%; font-size: 1rem; padding: 15px 20px; background: rgba(0,0,0,0.4); color: var(--color-text-light); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 12px; appearance: none; cursor: pointer; transition: var(--transition-speed); background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23cc9955%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E"); background-repeat: no-repeat; background-position: right 20px center; background-size: 12px; }
    select.modern-select:focus { border-color: var(--color-gold); box-shadow: 0 0 15px rgba(212, 175, 55, 0.2); outline: none; }
    
    audio { width: 100%; height: 40px; margin-top: 15px; border-radius: 20px; }
    audio::-webkit-media-controls-panel { background-color: rgba(255,255,255,0.9); }

    .back-button { background: linear-gradient(135deg, var(--color-gold), #c2923a); color: var(--color-bg-main); padding: 12px 30px; border-radius: 30px; text-decoration: none; font-weight: 700; display: inline-flex; margin-bottom: 40px; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); transition: var(--transition-speed); border: none; }
    .back-button:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(212, 175, 55, 0.4); }

    footer { background: rgba(15, 22, 28, 0.8); padding: 50px 20px; text-align: center; color: var(--color-text-muted); border-top: 1px solid rgba(255,255,255,0.05); }
    footer a { color: var(--color-gold); text-decoration: none; }

    /* Styles for error messages */
    .error-message {
        background: rgba(255, 0, 0, 0.15);
        color: #ff6b6b;
        padding: 25px;
        border-radius: var(--radius);
        margin-top: 30px;
        border: 1px solid rgba(255, 0, 0, 0.3);
        text-align: center;
        box-shadow: 0 4px 15px rgba(255, 0, 0, 0.2);
    }
    .error-message h3 {
        color: #ffb3b3;
        margin-bottom: 10px;
    }
    .error-message p {
        margin-bottom: 10px;
        font-size: 1rem;
    }
    .error-message small {
        display: block;
        margin-top: 15px;
        color: #e0e0e0;
        font-size: 0.9em;
    }


    @media (max-width: 768px) {
      header h1 { font-size: 2.2rem; }
      .controls-wrapper { grid-template-columns: 1fr; }
      .arabic-text { font-size: 2rem; line-height: 2.2; text-align: center;}
      .ayah-container { padding: 25px 20px; }
      .surah-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <header>
    <h1>QuranBits Global</h1>
    <p>Explore the Holy Quran with multi-language translations and high-quality audio.</p>
  </header>

  <div class="container">
    <div id="app">
      <div id="loading" class="loading">Loading Quran data...</div>
    </div>
  </div>

  <footer>
    <p><strong>Developed by:</strong> <a href="mailto:salimabdu759@gmail.com">Mr. Abdu Salim</a></p>
    <p>üìç Kigali, Rwanda | <a href="tel:+250739390715">+250 739 390 715</a></p>
    <p>¬© 2025 QuranBits | Powered by <a href="https://quranapi.pages.dev" target="_blank">Quran API</a></p>
  </footer>

  <script>
    const SURAH_LIST_API_URL = 'https://quranapi.pages.dev/api/surah.json';
    const app = document.getElementById('app');
    const loading = document.getElementById('loading');
    let surahs = [];
    let currentSurah = null;
    
    // Language Configuration
    const SUPPORTED_LANGUAGES = {
        english: "English",
        simplified_arabic: "Simplified Arabic", // Using 'arabic2' data from API
        urdu: "Urdu (ÿßÿ±ÿØŸà)",
        hindi: "Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)",
        bengali: "Bengali (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)",
        spanish: "Spanish (Espa√±ol)",
        french: "French (Fran√ßais)",
        indonesian: "Indonesian (Bahasa Indonesia)",
        russian: "Russian (–†—É—Å—Å–∫–∏–π)",
        turkish: "Turkish (T√ºrk√ße)",
        chinese_simplified: "Chinese (ÁÆÄ‰Ωì‰∏≠Êñá)"
    };
    let selectedLanguage = 'english'; // Default language

    // Helper to detect RTL languages
    function isRTL(lang) {
        return ['urdu', 'arabic', 'simplified_arabic', 'persian'].includes(lang);
    }

    // Initialize app
    document.addEventListener('DOMContentLoaded', loadSurahList);

    async function loadSurahList() {
      try {
        loading.style.display = 'block';
        await new Promise(r => setTimeout(r, 300)); 
        const response = await fetch(SURAH_LIST_API_URL);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        surahs = await response.json();
        renderSurahList();
      } catch (error) { 
        console.error("Failed to load Surah list:", error); // Log the actual error
        app.innerHTML = `
            <div class="error-message animate-in">
                <h3>‚ö†Ô∏è Error Loading Surah List!</h3>
                <p>We couldn't retrieve the list of Surahs.</p>
                <p>Please check your internet connection or try again later.</p>
                <small>If running locally, ensure your Live Server is active.</small>
            </div>
        `;
      } finally {
        loading.style.display = 'none';
      }
    }

    function renderSurahList() {
        app.innerHTML = `
            <div class="animate-in">
             <h2 style="color: var(--color-gold); margin-bottom: 30px;">Select a Surah</h2>
            </div>
            <div class="surah-grid">
                ${surahs.map((s, index) => `
                    <a href="#" class="surah-card glass-panel animate-in" data-no="${s.surahNo}" style="animation-delay: ${index * 0.03}s">
                        <div class="surah-card-header">
                            <span class="surah-number">${s.surahNo}</span> 
                            <span class="arabic-name">${s.surahNameArabic}</span>
                        </div>
                        <div class="surah-content">
                            <span class="surah-title-en">${s.surahName}</span>
                            <div class="surah-meta">
                                <span class="meta-badge">${s.surahNameTranslation}</span>
                                <span class="meta-badge">${s.totalAyah} Ayahs</span>
                            </div>
                        </div>
                    </a>`).join('')}
            </div>
        `;
        
        document.querySelectorAll('.surah-card').forEach(link =>
            link.addEventListener('click', e => {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
                // This will now correctly pass the Surah number!
                loadSurahDetails(link.dataset.no); 
            })
        );
    }

    async function loadSurahDetails(no) {
      try {
        app.innerHTML = '<div class="loading">Loading Surah & Translations...</div>';
        const response = await fetch(`https://quranapi.pages.dev/api/${no}.json`);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        currentSurah = await response.json();
        
        // Handle API typo for Russian and map 'arabic2' to 'simplified_arabic'
        if(currentSurah['russain']) { currentSurah['russian'] = currentSurah['russain']; }
        currentSurah['simplified_arabic'] = currentSurah['arabic2']; // Map existing data

        renderSurahDetails();
      } catch (error) { 
        console.error(`Failed to load details for Surah ${no}:`, error); // Log the actual error
        app.innerHTML = `
            <div class="error-message animate-in">
                <h3>‚ö†Ô∏è Could Not Load Surah Details!</h3>
                <p>There was a problem fetching the data for Surah ${no || 'the requested Surah'}.</p>
                <p>Please check your internet connection and ensure the API is accessible.</p>
                <p>If you're running this website locally, ensure your development server (e.g., Live Server) is running correctly.</p>
                <small>Check the browser's developer console (F12) for more technical details.</small>
                <div style="margin-top: 20px;"><a href="#" class="back-button" id="back-from-error">‚Üê Go Back</a></div>
            </div>
        `;
        // Add event listener for the back button in the error message
        document.getElementById('back-from-error').addEventListener('click', e => {
            e.preventDefault();
            renderSurahList();
        });
      }
    }

    function renderSurahDetails() {
      if (!currentSurah) return;
      const reciters = [
        { id: '1', name: 'Mishary Al Afasy' },
        { id: '2', name: 'Abu Bakr Al Shatri' }
      ];
      
      app.innerHTML = `
        <div class="animate-in"><a href="#" class="back-button" id="back">‚Üê Back to List</a></div>
        
        <h2 class="animate-in" style="color: var(--color-gold); font-size: 2.5rem; margin-bottom: 10px; text-align:center;">
            ${currentSurah.surahNameArabic}
        </h2>
         <h3 class="animate-in" style="text-align:center; margin-bottom: 30px; color: var(--color-text-muted)">
            ${currentSurah.surahName} - ${currentSurah.surahNameTranslation}
        </h3>

        <div class="glass-panel animate-in" style="padding: 30px; margin-bottom: 40px;">
          <h3 style="text-align:center; margin-bottom: 20px;">üéß Audio & Translation Settings</h3>
          <audio id="main-surah-audio" controls style="margin-bottom: 25px;">
            <source src="${currentSurah.audio['1'].url}" type="audio/mp3">
          </audio>
          
          <div class="controls-wrapper">
              <div>
                <label for="reciter" class="control-header">üó£Ô∏è Reciter</label>
                <select id="reciter" class="modern-select">
                    ${reciters.map(r => `<option value="${r.id}">${r.name}</option>`).join('')}
                </select>
              </div>
              
              <div>
                <label for="language-select" class="control-header">üåê Translation Language</label>
                <select id="language-select" class="modern-select">
                    ${Object.entries(SUPPORTED_LANGUAGES).map(([key, name]) => {
                        // Only show options if the API actually returned data for that language
                        if(currentSurah[key]) {
                            return `<option value="${key}" ${key === selectedLanguage ? 'selected' : ''}>${name}</option>`;
                        }
                    }).join('')}
                </select>
              </div>
          </div>
        </div>

        <div id="ayahs-list-container"></div>
      `;
      
      // Render the initial list of Ayahs
      renderAyahListItems();

      // Event Listeners
      document.getElementById('back').addEventListener('click', e => { e.preventDefault(); renderSurahList(); });
      
      document.getElementById('reciter').addEventListener('change', e => {
        const audioEl = document.getElementById('main-surah-audio');
        audioEl.src = currentSurah.audio[e.target.value].url;
        audioEl.play();
      });

      // Language change event listener
      document.getElementById('language-select').addEventListener('change', (e) => {
         selectedLanguage = e.target.value;
         // Re-render only the ayah list part, kept smooth
         renderAyahListItems();
      });
    }

    // Separated function for rendering Ayah list
    function renderAyahListItems() {
        const container = document.getElementById('ayahs-list-container');
        const rtlDir = isRTL(selectedLanguage) ? 'rtl' : 'ltr';
        
        // Use the selected language data. Fallback to English if the selected language data is missing.
        const translationData = currentSurah[selectedLanguage] || currentSurah.english;

        container.innerHTML = currentSurah.arabic1.map((ayah, i) => `
          <div class="ayah-container glass-panel animate-in" style="animation-delay: ${i * 0.05}s">
            <div class="ayah-header">
                <span class="ayah-number-badge">${i + 1}</span>
            </div>
            <div class="arabic-text">${ayah}</div>
            
            <div class="translation" dir="${rtlDir}" lang="${selectedLanguage}">
                ${translationData[i]}
            </div>

            <div style="margin-top: 20px; border-top: 1px dashed rgba(255,255,255,0.1); padding-top: 15px;">
                <audio controls src="https://quranaudio.pages.dev/1/${currentSurah.surahNo}_${i + 1}.mp3"></audio>
            </div>
          </div>`).join('');
    }
  </script>
</body>
</html>